C51 COMPILER V9.52.0.0   PWM                                                               04/08/2016 00:31:47 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN pwm.OBJ
COMPILER INVOKED BY: F:\Keil\C51\BIN\C51.EXE pwm.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "pwm.h"
   2          
   3          //========================================================================
   4          // 函数: void PCA_Init(void)
   5          // 描述: PCA初始化程序.
   6          //========================================================================
   7          void  PCA_Init(void)
   8          {
   9   1        CR = 0;
  10   1        AUXR1 = (AUXR1 & ~(3<<4)) | PCA_P24_P25_P26_P27;  //切换IO口
  11   1        //将PCA/PWM切换到P24(ECI) P25(CCP0) P26(CCP1) P27(CCP2)
  12   1        CCON = 0; //初始化PCA控制寄存器
  13   1        
  14   1        PCA_PWM0 = (PCA_Mode_Capture | ENABLE); //8位模式
  15   1        PCA_PWM1 = (PCA_Mode_Capture | ENABLE);
  16   1        PCA_PWM2 = (PCA_Mode_Capture | DISABLE);
  17   1        
  18   1        CCAPM0 = 0x42; //PCA模块0为8位PWM模式
  19   1        CCAPM1 = 0x42; //PCA模块1为8位PWM模式
  20   1        CCAPM2 = 0x42; //PCA模块2为8位PWM模式
  21   1      
  22   1        CH = 0;
  23   1        CL = 0;
  24   1        //选择时钟源
  25   1        CMOD = 0x02; //设置PCA时钟源 1T
  26   1      
  27   1        pwm0 = 0; //给PWM一个初值
  28   1        pwm1 = 0;
  29   1        pwm2 = 0;
  30   1      
  31   1        PWMn_Update(PCA0,pwm0);
  32   1        PWMn_Update(PCA1,pwm1);
  33   1        //PWMn_Update(PCA2,pwm2);
  34   1      
  35   1        CR    = 1;  // 运行PCA定时器
  36   1        //  EA = 1;
  37   1        P2M1 &= ~(0xe0);  //P2.7 P2.6 P2.5 设置为推挽输出
  38   1        P2M0 |=  (0xe0);
  39   1      }
  40          //========================================================================
  41          // 函数: void  delay_ms(u8 ms)
  42          // 描述: 延时函数。
  43          // 参数: ms,要延时的ms数, 这里只支持1~255ms. 自动适应主时钟.
  44          //========================================================================
  45          void  delay_ms(u16 ms)
  46          {
*** WARNING C235 IN LINE 46 OF pwm.c: parameter 1: different types
  47   1           unsigned int i;
  48   1         do{
  49   2              i = MAIN_Fosc / 13000;
  50   2            while(--i)  ;
  51   2           }while(--ms);
  52   1      }
  53          
  54          
C51 COMPILER V9.52.0.0   PWM                                                               04/08/2016 00:31:47 PAGE 2   

  55          //========================================================================
  56          // 函数: void PWMn_SetHighReg(unsigned int high)
  57          // 描述: 更新占空比数据。
  58          // 参数: high:高电位周期 0-255
  59          //========================================================================
  60          void PWMn_Update(u8 PCA_id, u16 pwm)
  61          {
  62   1        if(PCA_id == PCA0)
  63   1        {
  64   2          CR = 0;           //停止PCA一会， 一般不会影响PWM。
  65   2          CCAP0H = CCAP0L=0xff-pwm;
  66   2          CR = 1;           //启动PCA。
  67   2        }
  68   1        else if(PCA_id == PCA1)
  69   1        {
  70   2          CR = 0;           //停止PCA。
  71   2          CCAP1H = CCAP1L=0xff-pwm;
  72   2          CR = 1;           //启动PCA。
  73   2        }
  74   1        else if(PCA_id == PCA2)
  75   1        {
  76   2          CR = 0;           //停止PCA。
  77   2          CCAP2H = CCAP2L=0xff-pwm;
  78   2          CR = 1;           //启动PCA。
  79   2        }
  80   1      }
  81          
  82          
  83          
  84          /*
  85          #define   PWM_DUTY    6000    //定义PWM的周期，数值为PCA所选择的时钟脉冲个数。
  86          #define   PWM_HIGH_MIN  80    //限制PWM输出的最小占空比, 避免中断里重装参数时间不够。
  87          #define   PWM_HIGH_MAX  (PWM_DUTY - PWM_HIGH_MIN) //限制PWM输出的最大占空比。
  88          */
  89          void  pwm_left(u8 highpwm)//最小值PWM_HIGH_MIN  最大值PWM_HIGH_MAX
  90          {
  91   1        PWMn_Update(PCA1,highpwm);
  92   1      }
  93          void  pwm_right(u8 highpwm)
  94          {
  95   1        PWMn_Update(PCA0,highpwm);
  96   1      }
  97          
  98          
  99          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    173    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
